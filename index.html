<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Informes (v7.0)</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- 
        (v7.0) ESTILOS PERSONALIZADOS
        Se movió el contenido de style.css aquí, usando type="text/tailwindcss"
        para que el CDN de Tailwind pueda procesar las directivas @apply.
        El archivo style.css original ya no es necesario.
    -->
    <style type="text/tailwindcss">
        /* --- VARIABLES DE COLOR CSS --- */
        :root {
            --brand-primary: #F97316;
            --brand-secondary: #3B82F6;
            --brand-blue-dark: #1e40af;
            --brand-bg: #f8fafc; /* (DISEÑO v7.0) slate-50, más limpio */
            --brand-text: #334155; /* slate-700 */
            --brand-header: #0f172a; /* slate-900 */
            --brand-surface: #ffffff; /* white */
            --brand-border: #e2e8f0; /* slate-200 */
            --brand-red: #DC2626;
            --brand-green: #16A34A;
            --brand-yellow: #ca8a04;

            /* Colores de materias */
            --color-lectura: #0284c7;
            --color-matematicas: #dc2626;
            --color-sociales: #ca8a04;
            --color-ciencias: #16a34a;
            --color-ingles: #9333ea;
        }

        /* --- ESTILOS DE COMPONENTES BASE --- */
        .form-label {
            @apply block text-sm font-medium text-brand-text/90 mb-1.5; /* Más espacio */
        }

        .form-input {
            @apply block w-full px-3.5 py-2 bg-brand-surface border border-brand-border rounded-lg shadow-sm /* (DISEÑO v7.0) .rounded-lg */
                   placeholder-brand-text/40
                   focus:outline-none focus:ring-2 focus:ring-brand-secondary/50 focus:border-brand-secondary
                   transition duration-150 ease-in-out;
        }

        /* Botones Principales (DISEÑO v7.0) */
        .button-primary {
            @apply inline-flex items-center justify-center px-4 py-2 bg-brand-secondary border border-transparent rounded-lg /* .rounded-lg */
                   font-semibold text-sm text-white
                   hover:bg-brand-blue-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-secondary
                   transition-all duration-200 ease-in-out shadow-sm
                   hover:shadow-md hover:-translate-y-px; /* Efecto hover */
        }

        .button-primary-green {
            @apply inline-flex items-center justify-center px-4 py-2 bg-brand-green border border-transparent rounded-lg
                   font-semibold text-sm text-white
                   hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-green
                   transition-all duration-200 ease-in-out shadow-sm
                   hover:shadow-md hover:-translate-y-px;
        }

        .button-secondary {
            @apply inline-flex items-center justify-center px-4 py-2 bg-brand-surface border border-brand-border rounded-lg
                   font-semibold text-sm text-brand-text
                   hover:bg-brand-bg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-secondary/50
                   transition-all duration-200 ease-in-out shadow-sm
                   hover:shadow-md hover:-translate-y-px;
        }

        .button-danger {
            @apply inline-flex items-center justify-center px-4 py-2 bg-red-50 border border-red-200 rounded-lg
                   font-semibold text-sm text-brand-red
                   hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-400
                   transition-all duration-200 ease-in-out shadow-sm
                   hover:shadow-md hover:-translate-y-px;
        }

        /* --- ESTILOS DE LAYOUT (SIDEBAR Y CONTENIDO) (DISEÑO v7.0) --- */
        .nav-link {
            @apply flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-brand-text
                   hover:bg-brand-bg hover:text-brand-header
                   transition-colors duration-150 ease-in-out;
        }

        /* Estilo de link activo más pronunciado */
        .nav-link.active {
            @apply bg-brand-secondary/10 text-brand-secondary font-semibold
                   border-l-4 border-brand-secondary;
            @apply px-2; /* Ajustar padding por el borde */
        }

        .nav-link i {
            @apply w-5 h-5;
        }

        /* Para ocultar/mostrar secciones de admin/estudiante */
        .nav-section.admin-nav,
        .nav-section.student-nav {
            display: none; /* Ocultos por defecto */
        }

        /* Clases de utilidad */
        .app-section {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- ESTILOS DE COMPONENTES DE DASHBOARD (DISEÑO v7.0) --- */
        .card-base {
            /* Estilo base para todas las tarjetas */
            @apply bg-brand-surface p-5 rounded-xl shadow-sm border border-brand-border
                   transition-all duration-300 ease-in-out;
        }

        /* Tarjetas de Informes (Estudiante) */
        .report-card {
            @apply card-base
                   hover:shadow-lg hover:border-brand-secondary/50;
        }

        .report-card-placeholder {
            @apply bg-brand-surface p-5 rounded-xl shadow-sm border border-brand-border h-40 animate-pulse;
        }

        /* Tarjetas de Métricas (Admin KPI) */
        .kpi-card {
            @apply card-base;
        }
        .kpi-icon {
            @apply w-10 h-10 rounded-lg flex items-center justify-center mb-3; /* .rounded-lg */
        }
        .kpi-icon i {
            @apply w-5 h-5;
        }
        .kpi-label {
            @apply text-sm text-brand-text/80 mb-1;
        }
        .kpi-value {
            @apply text-3xl font-bold text-brand-header;
        }

        /* Tabla de Gestión (Admin) */
        .table-header {
            @apply px-4 py-3 text-left text-xs font-semibold text-brand-text/70 uppercase tracking-wider cursor-pointer
                   hover:bg-slate-100;
        }
        .table-cell {
            @apply px-4 py-4 whitespace-nowrap text-sm; /* Más padding vertical */
        }
        .table-row {
            @apply border-b border-brand-border transition-colors duration-150;
        }
        .table-row:last-child {
            @apply border-b-0;
        }
        .table-row:hover {
            @apply bg-brand-bg;
        }

        /* --- MODALS (DISEÑO v7.0) --- */
        .modal-backdrop {
            @apply fixed inset-0 z-40 bg-black/40 backdrop-blur-sm /* Añadido backdrop-blur */
                   flex items-center justify-center p-4
                   opacity-0 invisible transition-opacity duration-300 ease-in-out;
        }
        .modal-backdrop.shown {
            @apply opacity-100 visible;
        }

        .modal-container {
            @apply bg-brand-surface w-full rounded-xl shadow-2xl border border-brand-border /* .rounded-xl */
                   transform scale-95 opacity-0 transition-all duration-300 ease-in-out;
        }
        .modal-backdrop.shown .modal-container {
            @apply scale-100 opacity-100;
        }

        .modal-header-container {
            @apply flex items-center justify-between p-5 border-b border-brand-border; /* Más padding */
        }
        .modal-header {
            @apply text-lg font-semibold text-brand-header;
        }
        .modal-close-btn {
            @apply text-brand-text/60 hover:text-brand-red hover:bg-red-100 rounded-full p-1
                   transition-colors duration-150;
        }

        /* Filtros de Gráfico (Modal y Estudiante) */
        .chart-filter-btn {
            @apply px-3 py-1.5 border border-brand-border rounded-full
                   text-sm font-medium text-brand-text
                   hover:bg-brand-bg
                   transition-all duration-200;
        }
        .chart-filter-btn.active {
            @apply bg-brand-secondary text-white border-brand-secondary;
        }

        /* --- ESTILOS DEL INFORME INDIVIDUAL (DISEÑO v7.0) --- */
        .score-card {
            @apply card-base text-center;
        }
        .score-card .subject-icon {
            /* (v7.0) Los íconos de materia SVG han sido reemplazados por Lucide.
               Si se quisieran usar los SVGs, se usaría:
               @apply w-10 h-10 mx-auto mb-3;
            */
             @apply w-10 h-10 mx-auto mb-3;
        }
        .score-card .score-value {
            @apply text-4xl font-extrabold text-brand-header;
        }
        .score-card .score-label {
            @apply text-sm font-medium text-brand-text/80;
        }
        /* Estilo para las pestañas (tabs) del informe */
        .tab-btn {
            @apply py-3 px-1 border-b-2 border-transparent
                   text-brand-text/70 font-medium text-sm
                   hover:text-brand-header hover:border-brand-border
                   transition-all duration-200;
        }
        .tab-btn.active {
            @apply text-brand-secondary border-brand-secondary font-semibold;
        }

        .feedback-table th {
            @apply px-3 py-3 text-left text-xs font-medium text-brand-text/70 uppercase tracking-wider bg-slate-50;
        }
        .feedback-table td {
            @apply px-3 py-3 text-sm; /* Más padding */
        }
        .feedback-table .icon-correct {
            @apply w-5 h-5 text-brand-green;
        }
        .feedback-table .icon-incorrect {
            @apply w-5 h-5 text-brand-red;
        }

        /* --- ESTILOS DE ANÁLISIS DE ÍTEMS (ADMIN) (DISEÑO v7.0) --- */
        .stats-card {
            @apply card-base;
        }
        .stats-card-header {
            @apply flex flex-col sm:flex-row justify-between sm:items-center pb-3 border-b border-brand-border gap-2;
        }
        .stats-card-title {
            @apply text-base font-semibold text-brand-header;
        }
        .stats-card-pills {
            @apply flex items-center gap-2;
        }
        .stats-pill {
            @apply px-2.5 py-0.5 rounded-full text-xs font-medium;
        }
        .stats-pill-green { @apply bg-green-100 text-green-800; }
        .stats-pill-yellow { @apply bg-yellow-100 text-yellow-800; }
        .stats-pill-red { @apply bg-red-100 text-red-800; }
        .stats-pill-gray { @apply bg-slate-100 text-slate-700; }

        .distractor-bar-container {
            @apply w-full bg-slate-100 rounded-full h-3; /* (DISEÑO v7.0) Más gruesa */
        }
        .distractor-bar {
            @apply h-3 rounded-full transition-all duration-500;
        }
    </style>

    <script>
        // Configuración de Tailwind CSS (v7.0)
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'brand-primary': '#F97316',
                        'brand-secondary': '#3B82F6',
                        'brand-blue-dark': '#1e40af',
                        'brand-bg': '#f8fafc', // (DISEÑO v7.0) Fondo más limpio: slate-50
                        'brand-text': '#334155', // slate-700
                        'brand-header': '#0f172a', // slate-900
                        'brand-surface': '#ffffff', // white
                        'brand-border': '#e2e8f0', // slate-200
                        'brand-red': '#DC2626',
                        'brand-green': '#16A34A',
                        'brand-yellow': '#ca8a04',
                        // Colores de materias
                        'color-lectura': '#0284c7',
                        'color-matematicas': '#dc2626',
                        'color-sociales': '#ca8a04',
                        'color-ciencias': '#16a34a',
                        'color-ingles': '#9333ea',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-brand-bg text-brand-text font-sans antialiased">

    <!-- ========== PANTALLA DE CARGA GLOBAL ========== -->
    <div id="global-loader" class="fixed inset-0 bg-brand-bg z-[100] flex flex-col items-center justify-center transition-opacity duration-300">
        <!-- Logo o Icono -->
        <svg class="h-12 w-12 text-brand-primary animate-pulse" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18c-2.305 0-4.408.867-6 2.292m0-14.25v14.25" />
        </svg>
        <p class="text-brand-header font-medium mt-4 text-sm">Cargando plataforma...</p>
        <p id="loading-error-message" class="text-brand-red text-sm mt-2 hidden">
            Error al cargar datos. Revisa la consola y recarga la página.
        </p>
    </div>


    <!-- ========== PANTALLA DE LOGIN ========== -->
    <div id="login-screen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <div class="bg-brand-surface p-8 rounded-xl shadow-lg border border-brand-border">
                
                <!-- Cabecera del Login -->
                <div class="text-center mb-8">
                    <svg class="h-12 w-12 text-brand-primary mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18c-2.305 0-4.408.867-6 2.292m0-14.25v14.25" />
                    </svg>
                    <h1 class="text-2xl font-bold text-brand-header mt-4">Plataforma de Informes</h1>
                    <p class="text-brand-text text-sm mt-1">Accede a tus resultados</p>
                </div>

                <!-- Formulario de Login -->
                <form id="login-form">
                    <div class="mb-4">
                        <label for="doc-type" class="form-label">Tipo de Documento</label>
                        <select id="doc-type" class="form-input">
                            <option value="TI">Tarjeta de Identidad (TI)</option>
                            <option value="CC">Cédula de Ciudadanía (CC)</option>
                            <option value="CE">Cédula de Extranjería (CE)</option>
                            <option value="PEP">PEP</option>
                            <option value="PPT">PPT</option>
                             <option value="O">Otro</option> <!-- (v6.6) Añadido para compatibilidad de DB -->
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="doc-number" class="form-label">Número de Documento</label>
                        <input type="text" id="doc-number" class="form-input" placeholder="Tu número de documento" required>
                    </div>

                    <div class="mb-6">
                        <!-- (v6.6) Label corregido a Fecha de Nacimiento -->
                        <label for="password" class="form-label">Contraseña (Fecha de Nacimiento)</label>
                        <div class="relative">
                            <!-- (v6.6) Placeholder corregido -->
                            <input type="password" id="password" class="form-input" placeholder="ej: 4/2/2004" required>
                            <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 px-3 flex items-center text-brand-text/60 hover:text-brand-text" title="Ver/Ocultar contraseña">
                                <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                <svg id="eye-off-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 hidden">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243l-4.243-4.243" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="button-primary w-full">
                        Ingresar
                    </button>
                    
                    <p id="login-error" class="text-brand-red text-center text-sm mt-4 hidden">
                        ¡Error! Documento o contraseña incorrectos.
                    </p>
                </form>
            </div>
        </div>
    </div>


    <!-- ========== PLATAFORMA PRINCIPAL (APP) ========== -->
    <div id="app-container" class="hidden">
        
        <!-- Barra Lateral (Sidebar) -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-30 w-64 bg-brand-surface border-r border-brand-border flex flex-col transition-transform duration-300 ease-in-out -translate-x-full md:translate-x-0">
            <!-- Logo Header -->
            <div class="flex items-center justify-between h-16 px-4 border-b border-brand-border">
                <div class="flex items-center gap-2">
                    <svg class="h-8 w-8 text-brand-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18c-2.305 0-4.408.867-6 2.292m0-14.25v14.25" />
                    </svg>
                    <span class="text-lg font-bold text-brand-header">Informes</span>
                </div>
                <!-- Botón de cerrar (móvil) -->
                <button id="sidebar-close-btn" class="md:hidden text-brand-text/60 hover:text-brand-text">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <!-- Navegación -->
            <nav id="sidebar-nav" class="flex-1 overflow-y-auto p-4">
                <ul class="space-y-2">
                    <!-- Navegación de Estudiante -->
                    <li class="nav-section student-nav">
                        <a href="#" id="nav-student-dashboard" class="nav-link active">
                            <i data-lucide="layout-dashboard"></i>
                            <span>Mis Informes</span>
                        </a>
                    </li>
                    <li class="nav-section student-nav">
                        <a href="#" id="nav-student-growth" class="nav-link">
                            <i data-lucide="trending-up"></i>
                            <span>Mi Progreso</span>
                        </a>
                    </li>
                    
                    <!-- Navegación de Administrador -->
                    <li class="nav-section admin-nav">
                        <a href="#" id="nav-admin-dashboard" class="nav-link active">
                            <i data-lucide="bar-chart-horizontal"></i>
                            <span>Dashboard General</span>
                        </a>
                    </li>
                    <li class="nav-section admin-nav">
                        <a href="#" id="nav-admin-students" class="nav-link">
                            <i data-lucide="users"></i>
                            <span>Gestión Estudiantes</span>
                        </a>
                    </li>
                    <li class="nav-section admin-nav">
                        <a href="#" id="nav-admin-stats" class="nav-link">
                            <i data-lucide="pie-chart"></i>
                            <span>Análisis de Ítems</span>
                        </a>
                    </li>
                    <li class="nav-section admin-nav">
                        <a href="#" id="nav-admin-crud" class="nav-link">
                            <i data-lucide="database"></i>
                            <span>Gestión de Datos</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Footer de Sidebar (Logout) -->
            <div class="p-4 border-t border-brand-border">
                <button id="logout-btn" class="nav-link w-full bg-red-50 hover:bg-red-100 text-brand-red">
                    <i data-lucide="log-out"></i>
                    <span>Cerrar Sesión</span>
                </button>
            </div>
        </aside>

        <!-- Overlay para sidebar (móvil) -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-20 hidden md:hidden"></div>

        <!-- Contenido Principal -->
        <main id="main-content" class="md:pl-64 transition-all duration-300 ease-in-out">
            
            <!-- Cabecera de Contenido (Header) -->
            <header class="sticky top-0 z-10 bg-brand-surface/80 backdrop-blur-sm border-b border-brand-border h-16 flex items-center justify-between px-4 sm:px-6">
                <!-- Botón de menú (móvil) -->
                <button id="sidebar-open-btn" class="md:hidden text-brand-text/80 hover:text-brand-text">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>

                <!-- Título de la Sección -->
                <h1 id="main-content-title" class="text-lg font-semibold text-brand-header ml-2 md:ml-0">
                    Cargando...
                </h1>

                <!-- Perfil de Usuario -->
                <div class="flex items-center gap-3">
                    <div class="text-right hidden sm:block">
                        <p id="user-name-header" class="text-sm font-medium text-brand-header">...</p>
                        <p id="user-role-header" class="text-xs text-brand-text/70">...</p>
                    </div>
                    <div id="user-avatar-header" class="w-10 h-10 rounded-full bg-brand-secondary text-white flex items-center justify-center font-bold text-lg">
                        ?
                    </div>
                </div>
            </header>

            <!-- Contenedor de Secciones -->
            <div class="p-4 sm:p-6 space-y-6">

                <!-- ====================================================== -->
                <!-- SECCIÓN: DASHBOARD ESTUDIANTE (MIS INFORMES)            -->
                <!-- ====================================================== -->
                <section id="student-dashboard-section" class="app-section">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-5">
                        <h2 class="text-2xl font-bold text-brand-header">Mis Informes</h2>
                        <button id="show-growth-chart-btn" class="button-secondary mt-2 sm:mt-0">
                            <i data-lucide="trending-up" class="w-4 h-4 mr-2"></i>
                            Ver Mi Progreso
                        </button>
                    </div>
                    <div id="student-reports-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                        <!-- Tarjetas de informes se llenarán dinámicamente -->
                        <div class="report-card-placeholder"></div>
                        <div class="report-card-placeholder"></div>
                        <div class="report-card-placeholder"></div>
                    </div>
                </section>

                <!-- ====================================================== -->
                <!-- SECCIÓN: INFORME INDIVIDUAL ESTUDIANTE (SE OCULTA/MUESTRA) -->
                <!-- ====================================================== -->
                <section id="student-report-section" class="app-section hidden">
                    <!-- Cabecera del Informe -->
                    <div class="mb-6">
                        <button id="back-to-dashboard-btn" class="button-secondary text-sm mb-4">
                            <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                            Volver a Mis Informes
                        </button>
                        <h2 id="report-title" class="text-3xl font-extrabold text-brand-header">...</h2>
                        <p id="report-date" class="text-brand-text/80 mt-1">...</p>
                    </div>

                    <!-- Contenedor del Informe (Puntajes, Gráficos, Feedback) -->
                    <div id="report-content-container" class="space-y-6">
                        <!-- Aquí se inyectará el contenido del informe (puntajes, radar, feedback) -->
                    </div>
                </section>


                <!-- ====================================================== -->
                <!-- SECCIÓN: DASHBOARD ADMINISTRADOR (GENERAL)              -->
                <!-- ====================================================== -->
                <section id="admin-dashboard-section" class="app-section hidden">
                    <!-- 1. Tarjetas de Métricas (KPIs) -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-6">
                        <div class="kpi-card">
                            <div class="kpi-icon bg-blue-100 text-blue-600">
                                <i data-lucide="users"></i>
                            </div>
                            <p class="kpi-label">Total Estudiantes</p>
                            <p id="kpi-total-students" class="kpi-value">0</p>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon bg-orange-100 text-orange-600">
                                <i data-lucide="graduation-cap"></i>
                            </div>
                            <p class="kpi-label">Puntaje Global Promedio</p>
                            <p id="kpi-avg-global" class="kpi-value">0</p>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon bg-green-100 text-green-600">
                                <i data-lucide="file-check"></i>
                            </div>
                            <p class="kpi-label">Prom. Simulacros</p>
                            <p id="kpi-avg-simulacros" class="kpi-value">0</p>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-icon bg-yellow-100 text-yellow-600">
                                <i data-lucide="file-text"></i>
                            </div>
                            <p class="kpi-label">Prom. Minisimulacros</p>
                            <p id="kpi-avg-minis" class="kpi-value">0</p>
                        </div>
                    </div>

                    <!-- 2. Gráficos Globales -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-brand-surface p-5 rounded-xl shadow-sm border border-brand-border">
                            <h3 class="text-lg font-semibold text-brand-header mb-4">Promedio Global por Materia</h3>
                            <div class="h-64">
                                <canvas id="admin-avg-subjects-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-brand-surface p-5 rounded-xl shadow-sm border border-brand-border">
                            <h3 class="text-lg font-semibold text-brand-header mb-4">Distribución de Puntajes Globales</h3>
                            <div class="h-64">
                                <canvas id="admin-global-score-dist-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ====================================================== -->
                <!-- SECCIÓN: GESTIÓN DE ESTUDIANTES (ADMIN)                 -->
                <!-- ====================================================== -->
                <section id="admin-students-section" class="app-section hidden">
                    <div class="bg-brand-surface p-6 rounded-xl shadow-sm border border-brand-border">
                        <h2 class="text-2xl font-bold text-brand-header mb-4">Gestión de Estudiantes</h2>
                        
                        <!-- Barra de Búsqueda y Paginación -->
                        <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                            <div class="relative w-full md:w-1/3">
                                <input type="text" id="admin-student-search" class="form-input !pl-10" placeholder="Buscar por nombre o documento...">
                                <i data-lucide="search" class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-brand-text/40"></i>
                            </div>
                            <div id="admin-pagination-controls" class="flex items-center gap-2">
                                <!-- Controles se generan con JS -->
                            </div>
                        </div>

                        <!-- Tabla de Estudiantes -->
                        <div class="overflow-x-auto">
                            <table class="w-full min-w-max">
                                <thead>
                                    <tr class="border-b border-brand-border bg-slate-50">
                                        <th class="table-header" data-sort="Nombre Completo del Estudiante">Nombre</th>
                                        <th class="table-header" data-sort="Número de Documento">Documento</th>
                                        <th class="table-header" data-sort="Email">Email</th>
                                        <th class="table-header" data-sort="Colegio/institución">Colegio</th>
                                        <th class="table-header text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-student-table-body">
                                    <!-- Filas se generan con JS -->
                                </tbody>
                            </table>
                        </div>
                        <p id="admin-no-results" class="text-center text-brand-text/70 py-8 hidden">No se encontraron estudiantes.</p>
                    </div>
                </section>

                <!-- ====================================================== -->
                <!-- SECCIÓN: ANÁLISIS DE ÍTEMS (ADMIN)                      -->
                <!-- ====================================================== -->
                <section id="admin-stats-section" class="app-section hidden">
                    <div class="bg-brand-surface p-6 rounded-xl shadow-sm border border-brand-border">
                        <h2 class="text-2xl font-bold text-brand-header mb-4">Análisis Estadístico de Ítems</h2>
                        
                        <!-- Barra de Filtros -->
                        <div class="flex flex-col md:flex-row gap-4 mb-6 pb-6 border-b border-brand-border">
                            <!-- Selector de Prueba -->
                            <div class="flex-grow">
                                <label for="stats-test-select" class="form-label">Seleccionar Prueba</label>
                                <select id="stats-test-select" class="form-input">
                                    <option value="">Cargando pruebas...</option>
                                </select>
                            </div>
                            <!-- Selector de Materia -->
                            <div class="flex-grow">
                                <label for="stats-subject-filter" class="form-label">Filtrar por Materia</label>
                                <select id="stats-subject-filter" class="form-input" disabled>
                                    <option value="all">Todas las Materias</option>
                                    <!-- Opciones se llenan con JS -->
                                </select>
                            </div>
                            <!-- Botón de Análisis -->
                            <div class="self-end">
                                <button id="stats-analyze-btn" class="button-primary w-full md:w-auto">
                                    <i data-lucide="bar-chart-2" class="w-4 h-4 mr-2"></i>
                                    Analizar
                                </button>
                            </div>
                        </div>

                        <!-- Contenedor de Carga (Spinner) -->
                        <div id="stats-loading" class="text-center py-10 hidden">
                            <div class="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] text-brand-secondary" role="status"></div>
                            <p class="mt-3 text-brand-text/80">Procesando miles de respuestas...</p>
                        </div>
                        
                        <!-- Contenedor de Resultados (Tarjetas) -->
                        <div id="stats-results-container" class="hidden">
                            <h3 id="stats-results-title" class="text-xl font-semibold text-brand-header mb-4">...</h3>
                            <div id="stats-results-cards-container" class="space-y-4">
                                <!-- Tarjetas de estadísticas se generan con JS -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ====================================================== -->
                <!-- SECCIÓN: GESTIÓN DE DATOS (CRUD ADMIN)                  -->
                <!-- ====================================================== -->
                <section id="admin-crud-section" class="app-section hidden">
                    <div class="bg-brand-surface p-6 rounded-xl shadow-sm border border-brand-border">
                        <h2 class="text-2xl font-bold text-brand-header mb-4">Gestión de Datos (CRUD)</h2>
                        <p class="text-sm text-brand-text/80 mb-6">
                            Añade nuevos estudiantes a la base de datos. Los cambios se guardarán en caché y se enviarán a GitHub cuando hagas clic en "Guardar Cambios".
                        </p>
                        
                        <!-- Formulario para Añadir Estudiante -->
                        <form id="add-student-form" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 border-b border-brand-border pb-6 mb-6">
                            <h3 class="md:col-span-2 text-lg font-semibold text-brand-header">Añadir Nuevo Estudiante</h3>
                            
                            <div>
                                <label for="student-name" class="form-label">Nombre Completo</label>
                                <input type="text" id="student-name" class="form-input" required>
                            </div>
                            <div>
                                <label for="student-email" class="form-label">Email</label>
                                <input type="email" id="student-email" class="form-input" required>
                            </div>
                            <div>
                                <label for="student-doc-type" class="form-label">Tipo Documento</label>
                                <select id="student-doc-type" class="form-input">
                                    <option>TI</option>
                                    <option>CC</option>
                                    <option>CE</option>
                                    <option>PEP</option>
                                    <option>PPT</option>
                                    <option>O</option>
                                </select>
                            </div>
                            <div>
                                <label for="student-doc-number" class="form-label">Número Documento</label>
                                <input type="text" id="student-doc-number" class="form-input" required>
                            </div>
                            <div>
                                <label for="student-birthdate" class="form-label">Fecha Nacimiento (Contraseña)</label>
                                <input type="text" id="student-birthdate" placeholder="ej. 20/07/2005" class="form-input" required>
                            </div>
                            <div>
                                <label for="student-department" class="form-label">Departamento</label>
                                <input type="text" id="student-department" class="form-input" required>
                            </div>
                            <div class="md:col-span-2">
                                <label for="student-school" class="form-label">Colegio/Institución</label>
                                <input type="text" id="student-school" class="form-input" required>
                            </div>
                            
                            <!-- Botón de Envío -->
                            <div class="md:col-span-2 text-right">
                                <button type="submit" class="button-primary">
                                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                    Añadir a la cola
                                </button>
                            </div>
                        </form>

                        <!-- Panel de Cambios Pendientes (Caché) -->
                        <div>
                            <h3 class="text-lg font-semibold text-brand-header mb-3">Cambios Pendientes</h3>
                            <div id="pending-changes-container" class="bg-slate-50 border border-brand-border rounded-lg p-4 max-h-60 overflow-y-auto">
                                <p id="no-pending-changes" class="text-brand-text/70 text-sm">No hay cambios pendientes para guardar.</p>
                                <!-- Cambios pendientes se listan aquí -->
                            </div>
                            <div class="mt-4 text-right space-x-3">
                                <button id="clear-cache-btn" class="button-danger" disabled>
                                    <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                                    Descartar Cambios
                                </button>
                                <button id="save-changes-btn" class="button-primary-green" disabled>
                                    <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                                    Guardar Cambios en GitHub
                                </button>
                            </div>
                        </div>

                    </div>
                </section>

            </div> <!-- Fin de .p-4.sm:p-6 -->
        </main> <!-- Fin de #main-content -->

    </div> <!-- Fin de #app-container -->


    <!-- ====================================================== -->
    <!-- MODALS GLOBALES                                        -->
    <!-- ====================================================== -->

    <!-- Modal: Gráfico de Progreso (Estudiante) -->
    <div id="growth-chart-modal" class="modal-backdrop">
        <div class="modal-container max-w-3xl">
            <div class="modal-header-container">
                <h2 class="modal-header">Mi Progreso Histórico</h2>
                <button class="modal-close-btn" data-modal-id="growth-chart-modal" title="Cerrar">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <!-- Filtros del Gráfico -->
                <div id="growth-chart-filters" class="flex justify-center gap-2 mb-4 flex-wrap">
                    <button class="chart-filter-btn active" data-filter="all">Ver Todo</button>
                    <button class="chart-filter-btn" data-filter="simulacro">Simulacros</button>
                    <button class="chart-filter-btn" data-filter="minisimulacro">Minisimulacros</button>
                </div>
                <!-- Canvas del Gráfico -->
                <div class="h-80">
                    <canvas id="growthChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Historial de Estudiante (Admin) -->
    <div id="admin-student-modal" class="modal-backdrop">
        <div class="modal-container max-w-3xl">
            <div class="modal-header-container">
                <h2 id="admin-student-modal-title" class="modal-header">Historial de Informes</h2>
                <button class="modal-close-btn" data-modal-id="admin-student-modal" title="Cerrar">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div id="admin-student-modal-body" class="p-6 max-h-[70vh] overflow-y-auto space-y-4">
                <!-- Contenido se genera con JS -->
            </div>
        </div>
    </div>

    <!-- Modal: Token de GitHub (Admin CRUD) -->
    <div id="github-token-modal" class="modal-backdrop">
        <div class="modal-container max-w-md">
            <div class="modal-header-container">
                <h2 class="modal-header">Confirmación de Seguridad</h2>
                <button class="modal-close-btn" data-modal-id="github-token-modal" title="Cerrar">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <p class="text-brand-text/80 text-sm mb-4">
                    Para guardar los cambios en GitHub, por favor ingresa tu Token de Acceso Personal (PAT).
                </p>
                <div>
                    <label for="github-token-input" class="form-label">GitHub PAT (Personal Access Token)</label>
                    <input type="password" id="github-token-input" class="form-input" placeholder="ghp_...">
                </div>
                <p id="github-token-error" class="text-brand-red text-sm mt-2 hidden">Error. Token inválido o sin permisos.</p>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button class="button-secondary modal-close-btn">Cancelar</button>
                    <button id="github-token-confirm-btn" class="button-primary-green">
                        <i data-lucide="check" class="w-4 h-4 mr-2"></i>
                        Confirmar y Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- ====================================================== -->
    <!-- LIBRERÍAS JS (Movidas al final para carga secuencial)  -->
    <!-- ====================================================== -->

    <!-- 1. PapaParse (Lector de CSV) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <!-- 2. Chart.js (Gráficos) y sus adaptadores de fecha -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns"></script>

    <!-- 3. Lucide (Iconos) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 4. Tu script principal (se ejecuta DESPUÉS de las librerías) -->
    <!-- (v7.0) Este script ha sido refactorizado a una arquitectura modular -->
    <script src="./script.js"></script>

</body>
</html>
